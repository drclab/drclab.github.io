+++
title = "SBE 104: Estimating Lagged Effects in Switchbacks"
date = "2026-11-24"
type = "post"
draft = false
math = true
summary = "Section 2.4 of Bojinov, Simchi-Levi, and Zhao (2023): the Horvitz–Thompson estimator for lagged effects, a worked example, and why regular switchback designs keep it unbiased."
tags = ["causal-inference", "switchback-experiments"]
+++

Section 2.4 moves from design to estimation. Once a regular switchback design $(\mathcal{T}, \mathcal{Q})$ fixes the distribution $\eta_{\mathcal{T}, \mathcal{Q}}(\cdot)$, the authors estimate the average lag-$p$ causal effect with the Horvitz–Thompson (HT) estimator. It explicitly corrects for the unequal probabilities that each window of assignments appears under the design.

## The estimator

For a realized assignment path $w_{1:T}$, observed outcomes $Y^{\text{obs}}$, and the design’s assignment law $\eta_{\mathcal{T}, \mathcal{Q}}(\cdot)$, the HT estimator is

$$
\hat{\tau}_p(\eta_{\mathcal{T}, \mathcal{Q}}, w_{1:T}, Y) = \frac{1}{T-p} \sum_{t=p+1}^{T} \left( \frac{Y_t^{\text{obs}} \, \mathbb{1}\{w_{t-p:t} = \mathbf{1}_{p+1}\}}{\Pr(W_{t-p:t} = \mathbf{1}_{p+1})} - \frac{Y_t^{\text{obs}} \, \mathbb{1}\{w_{t-p:t} = \mathbf{0}_{p+1}\}}{\Pr(W_{t-p:t} = \mathbf{0}_{p+1})} \right). \tag{4}
$$

- The denominators use probabilities implied by the design—no new modeling assumptions intervene.
- Because regular switchbacks assign entire blocks with coin flips, these probabilities are products of coin biases. Under the optimal design (fair coins), they are powers of $1/2$, which keeps denominators away from zero and stabilizes the estimator.

## Example 5 (T = 4, p = m = 1)

With fair coins $\Pr(W_t = 1) = \Pr(W_t = 0) = 1/2$, each two-period window of identical treatments has probability $1/4$. If the realized path is $(1,1,0,0)$ (probability $1/16$), the estimator becomes

$$
\hat{\tau}_1 = \frac{1}{3} \left( 4 Y_2(1,1) + 0 - 4 Y_4(0,0) \right).
$$

The middle term is zero because window $(w_2, w_3) = (1,0)$ mixes treatment and control, so it contributes to neither numerator.

## Unbiasedness under regular designs

Proposition 1 shows that, under Assumptions 1–2 and any regular switchback, the HT estimator is unbiased for the average lag-$p$ causal effect:

$$
\mathbb{E}_{W_{1:T} \sim \eta_{\mathcal{T}, \mathcal{Q}}}[\hat{\tau}_p(\eta_{\mathcal{T}, \mathcal{Q}}, W_{1:T}, Y)] = \tau_p(Y).
$$

The expectation is over the assignment path drawn from the precommitted design; no assumptions are needed on outcome distributions beyond those already imposed by the switchback setup.

## Takeaways for running SBE

- Lock in a regular design with nonzero probabilities for all-treatment and all-control windows so the HT weights are defined.
- Fair coins are not just simple—they keep the HT denominator stable because every relevant window probability is a power of $1/2$.
- Once the design is fixed, computing $\hat{\tau}_p$ only requires observed outcomes and the realized path; the unbiasedness guarantee comes from the randomization itself.
